var references = require('references');
var files      = require('files');
var promises   = require('promises');

var exposed_modules = {
    'timers' : true //  going to be the set timeout and set inteval interface
};

var loaded = {};

module.exports = {
    load : function load(name) {
        try {
            if (exposed_modules[name]) {
                var m = require(name);
                if (m.unload === undefined) {
                    throw new Error('"' + name + '" does not export required "unload" function');
                }
                if (m.expose === undefined) {
                    throw new Error('"' + name + '" does not export required "expose" field');
                }
                loaded[name] = m.expose;
                return loaded[name];
            }
            else {
                throw new Error('No access to module named "' + name + '"');
            }
        }
        catch (error) {
            throw error;
        }
    },
    unload : function unload(name) {
        var m = loaded[name];
        if (m) m.unload();
        else throw new Error('"' + name + '" is not loaded');
    },
    reference : references.reference,
    resolve : references.resolve,
    File : files.File,
    Promise : promises.Promise
//    setTimeout : setTimeout,  need way to reference and stop outstanding timeouts and intervals
//    setInterval : setInterval
}
