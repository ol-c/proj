var traceback = require('traceback');

module.exports.check = check;
module.exports.associate = associate;

var associations = new Map();

function check(operation, authorization, field) {
    //  agents is a list of agents who are involved with this operation
    //  operation is the type of operation authorization is requested for
    //  authorization is the object to resolve authorization for
    //  field is the field the operation is requested for
    var callstack = traceback();
    var agents = [];
//    var function_names = [];
    for (var i=0; i<callstack.length; i++) {
        var fun = callstack[i].fun;
        if (associations.has(fun)) {
            agents.push(associations.get(fun));
        }
//        function_names.push(callstack[i].name);
    }
    console.log('agents', agents);
//    console.log(operation, 'authorized on', field);
}

function associate(_function, agent) {
    associations.set(_function, agent);
}
