var domain = require('domain');

module.exports.check = check;
module.exports.associate = associate;
module.exports.authorizations = authorizations;

var associations = new Map();

function check(operation, authorization, field) {
    //  agents is a list of agents who are involved with this operation
    //  operation is the type of operation authorization is requested for
    //  authorization is the object to resolve authorization for
    //  field is the field the operation is requested for
    if (domain.active) {
    //     console.log(operation, field, 'authorizations :', domain.active.authorizations, domain.active.name);
    }
    else {
    //    console.log('no active authorizations');
    }
}

function associate(agent) {
    if (domain.active) {
        if (domain.active.authorizations == undefined) {
//            console.log('!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! new', domain.active.name);
            domain.active.authorizations = [];
         }
         domain.active.authorizations.push(agent);
    }
}

function authorizations() {
    if (domain.active && domain.active.authorizations) {
        return domain.active.authorizations.slice(0);
    }
    else {
        return [];
    }
}
