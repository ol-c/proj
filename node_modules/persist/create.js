module.exports = create;

var get_time = require('./get_time');
var get_persistant_proxy = require('./get_persistant_proxy');
var lock = require('./lock');
var meta = require('./meta');


var valid_types = {
    'hashmap' : true,
    'list'    : true
};

function create(type, id, nobackup) {
    if (valid_types[type] === undefined) {
        throw new Error('"' + type + '" is not a valid type');
    }

    //  creates persistant object of type with a new id
    if (id === undefined) id = get_time() + '';
    else if (typeof id != 'string') {
        //console.log(id);
        throw new Error('id must be a string');
    }

    var proxy = get_persistant_proxy(id);
    lock(id, function (err, res) {
        if (err) console.log(err);
    });
    meta.get(proxy).loaded = true;
    meta.get(proxy).type = type;
    meta.get(proxy).backup = true;

    if (nobackup) {
        meta.get(proxy).backup = false;
    }
    return proxy;
}
