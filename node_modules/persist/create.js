module.exports = create;

var get_time = require('./get_time');
var get_persistant_proxy = require('./get_persistant_proxy');
var lock = require('./lock');
var meta = require('./meta');


function create(type, id, nobackup) {

    //  creates persistant object of type with a new id
    if (id === undefined) id = get_time() + '';
    else if (typeof id != 'string') {
        //console.log(id);
        throw new Error('id must be a string');
    }

    var proxy = get_persistant_proxy(type, id);
    lock(id, function (err, res) {
        if (err) console.log(err);
    });
    meta.get(proxy).loaded = true;
    meta.get(proxy).backup = true;

    //  write in the type information
    proxy.type = type;
    meta.get(proxy).type = type;

    //  don't need to delete, because the first set
    //  to type is never saved on the instance itself
    //      only on the persistant representation
    //delete proxy.type;

    if (nobackup) {
        meta.get(proxy).backup = false;
    }

    return proxy;
}
