var vm = require('vm');
var environment = require('environment');

function scoped(expression, object) {
    var custom_env = {};
    for (var field in environment) {
        custom_env[field] = environment[field];
    }
    custom_env.eval = function(arg1) {
        return (function (arg1) {
            return eval(arg1);
        }).call(object, arg1);
    };
    vm.runInNewContext('var _tmp_ = ' + expression, custom_env);
    return custom_env._tmp_;
}

module.exports = scoped;
