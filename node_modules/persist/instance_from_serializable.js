var Reference = require('references').Reference;
var File = require('files').File;
var scoped = require('./scoped');
var o = require('o');

//  take a serializable value and ble
function instance_from_serializable(value) {
    var unserialized;
    //  TODO: if value.data has unexpected form
    //        for type, throw an error
    if (value.type == 'string') {
        unserialized = value.data;
    }
    else if (value.type == 'hashmap') {
        unserialized = "need to get rid of the unserialize step when forwarding watching updates"
    }
    else if (value.type == 'date') {
        unserialized = new Date(value.data);
    }
    else if (value.type == 'function') {
        //  expose the toolbox to all users
        unserialized = scoped(value.data, o);
    }
    else if (value.type == 'boolean') {
        unserialized = value.data;
    }
    else if (value.type == 'null') {
        unserialized = null;
    }
    else if (value.type == 'number') {
        unserialized = parseFloat(value.data);
    }
    else if (value.type == 'reference') {
        unserialized = new Reference(value.data);
    }
    else if (value.type == 'file') {
        unserialized = new File(value.data);
    }
    else if (value.type == 'undefined') {
        unserialized = undefined;
    }
    else {
        throw new Error('cannot unserialize type: ' + value.type);
    }
    return unserialized;
}

module.exports = instance_from_serializable;
